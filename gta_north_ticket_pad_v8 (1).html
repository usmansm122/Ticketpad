<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Team GTA North ‚Äì Ticket Pad (All Protectors)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --red-main: #c8102e;
      --red-dark: #850018;
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --text-main: #222222;
      --text-muted: #666666;
      --border: #dddddd;
      --accent: var(--red-main);
      --radius-lg: 18px;
      --radius-md: 10px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffe5e9 0, #f5f5f7 40%, #e9f2ff 100%);
      color: var(--text-main);
    }

    .page-wrap {
      min-height: 100vh;
      padding: 24px;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 1350px;
    }

    .header-card {
      background: linear-gradient(135deg, var(--red-dark), var(--red-main));
      color: #fff;
      border-radius: 24px;
      padding: 20px 24px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 14px 40px rgba(0,0,0,0.25);
    }

    .header-left h1 {
      margin: 0 0 4px 0;
      font-size: 24px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .header-left p {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
    }

    .header-right {
      text-align: right;
      font-size: 12px;
      opacity: 0.9;
    }

    .header-right strong {
      display: block;
      font-size: 13px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 16px 18px 18px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.12);
      border: 1px solid rgba(0,0,0,0.04);
    }

    .card + .card {
      margin-top: 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 18px;
    }

    .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin: 0 0 4px 0;
    }

    .table-wrap {
      width: 100%;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
      min-width: 1150px;
    }

    thead {
      background: #fafafa;
    }

    th, td {
      padding: 6px 5px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      border-bottom: 1px solid #e0e0e0;
    }

    tbody tr:nth-child(even) {
      background: #fcfcfc;
    }

    select,
    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 3px 4px;
      font-size: 12px;
      border-radius: var(--radius-md);
      border: 1px solid #d0d0d0;
      outline: none;
      background: #fff;
    }

    input[type="number"] {
      text-align: right;
    }

    input[readonly] {
      background: #f7f7f7;
      color: #555;
    }

    select:focus, input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0,119,182,0.15);
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--red-main);
      color: #fff;
    }

    .btn-secondary {
      background: #f0f0f3;
      color: #333;
    }

    .btn-danger {
      background: #ffe7ea;
      color: #b00020;
    }

    .btn span.icon {
      font-size: 14px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .summary-item {
      background: #fafafa;
      border-radius: var(--radius-md);
      padding: 8px 10px;
      border: 1px solid #ebebeb;
    }

    .summary-item label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      display: block;
      margin-bottom: 3px;
    }

    .summary-item .value {
      font-size: 15px;
      font-weight: 600;
    }

    .summary-item .value.accent {
      color: var(--red-main);
    }

    .summary-item small {
      display: block;
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      flex-wrap: wrap;
    }

    .footer-note strong {
      color: var(--red-dark);
    }

    .card.summary-card .card-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .view-toggle {
      margin-left: auto;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .view-tab {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.14);
      background: #ffffff;
      color: var(--text-main);
      cursor: pointer;
      white-space: nowrap;
    }

    .view-tab.active {
      background: var(--red-main);
      border-color: var(--red-main);
      color: #ffffff;
    }

    .view-tab.view-tab-customer {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .view-tab .view-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.4);
      background: transparent;
      flex-shrink: 0;
    }

    .view-tab.view-tab-customer:hover .view-dot {
      background: rgba(0,0,0,0.06);
    }

    .view-tab.active .view-dot {
      background: #ffffff;
      border-color: #ffffff;
    }

    body.customer-view .assoc-view {
      display: none;
    }

    body.customer-view .customer-view-panel {
      display: block;
    }

    .customer-view-panel {
      display: none;
    }

    body.customer-view .card.line-card {
      display: none;
    }

    .customer-summary,
    .customer-foot {
      padding: 10px 12px;
      border-radius: 12px;
      background: #fafafa;
      border: 1px solid #e2e2e2;
      margin-bottom: 8px;
    }

    .customer-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .customer-row .label {
      color: var(--text-muted);
    }

    .customer-row .value {
      font-weight: 600;
    }

    .customer-summary .value.accent {
      color: var(--red-main);
    }

    .customer-breakdown {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid #e2e2e2;
    }

    .customer-breakdown-header {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .customer-breakdown-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cb-row {
      font-size: 12px;
      line-height: 1.35;
    }

    .cb-main {
      font-weight: 600;
    }

    .cb-sub {
      color: var(--text-muted);
    }

    .coupon-block {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .coupon-code {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px dashed rgba(0,0,0,0.25);
      background: #fff;
      display: inline-block;
    }

    .code-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .code-box {
      font-family: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.16em;
    }

    .policy-note {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.35;
    }

    .card.line-card {}

    .protection-card {
      margin-top: 18px;
      display: none;
    }

    .protection-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .prot-column {
      border-radius: 16px;
      padding: 12px 12px 14px;
      border: 1px solid #d4d4d4;
      background: #0f2535;
      color: #ffffff;
    }

    .prot-column.good { border-top: 4px solid #2a9d6f; }
    .prot-column.better { border-top: 4px solid #1d6fa5; }
    .prot-column.best { border-top: 4px solid #e67e22; }

    .prot-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
    }

    .prot-title {
      font-size: 16px;
      font-weight: 700;
      margin-top: 2px;
    }

    .prot-subtitle {
      font-size: 11px;
      opacity: 0.85;
      margin-bottom: 8px;
    }

    .prot-price {
      font-size: 22px;
      font-weight: 700;
      margin-top: 4px;
    }

    .prot-size-note {
      font-size: 11px;
      opacity: 0.85;
      margin-bottom: 6px;
    }

    .prot-bullets {
      list-style: none;
      padding-left: 0;
      margin: 6px 0 0 0;
      font-size: 11px;
    }

    .prot-bullets li::before {
      content: "‚úì";
      margin-right: 4px;
    }

    .prot-footnote {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Packages view toggle */
    body.packages-view .line-card,
    body.packages-view .summary-card {
      display: none;
    }

    body.packages-view .protection-card {
      display: block;
    }

    @media (max-width: 900px) {
      .summary-grid {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }

      .header-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .header-right {
        text-align: left;
      }

      .protection-grid {
        grid-template-columns: 1fr;
      }

      .view-toggle {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="container">

      <div class="header-card">
        <div class="header-left">
          <h1>Team GTA North ‚Äì Ticket Pad</h1>
          <p>Build mattress &amp; protection packages with clear ticket, savings and internal view.</p>
        </div>
        <div class="header-right">
          <strong>Internal view</strong>
          <span>Totals update live as you adjust the ticket.</span>
        </div>
      </div>

      <div class="card line-card">
        <div class="card-header">
          <h2>Line Items</h2>
        </div>
        <p class="hint">
          1) Pick a SKU from the catalog. 2) Size, brand, retail and cost auto-fill. 3) Adjust % off or selling price to test different offers.
        </p>
        <div class="table-wrap">
          <table id="bundle-table">
            <thead>
              <tr>
                <th style="width: 20%;">Catalog item</th>
                <th style="width: 6%;">Size</th>
                <th style="width: 12%;">Brand</th>
                <th style="width: 12%;">Item note</th>
                <th style="width: 9%;">Category</th>
                <th style="width: 8%;">Retail $</th>
                <th style="width: 7%;">Deal %</th>
                <th style="width: 8%;">Selling $</th>
                <th style="width: 8%;">Cost $</th>
                <th style="width: 7%;">GP $</th>
                <th style="width: 7%;">GP %</th>
                <th style="width: 7%;">Comm. $</th>
                <th style="width: 5%;"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="addRow()">
            <span class="icon">‚ûï</span> Add blank line
          </button>
          <button class="btn btn-secondary" type="button" id="btn-show-packages" onclick="toggleProtectionView()">
            <span class="icon">üõ°Ô∏è</span> Protection packages
          </button>
          <button class="btn btn-danger" type="button" onclick="clearAll()">
            <span class="icon">üóëÔ∏è</span> Clear all
          </button>
        </div>
      </div>

      <div class="card summary-card">
        <div class="card-header">
          <h2>Bundle Summary</h2>
          <div class="view-toggle">
            <button type="button" class="view-tab active" id="btn-detail-view">Detail</button>
            <button type="button" class="view-tab view-tab-customer" id="btn-customer-view">
              <span class="view-dot"></span>
              Customer
            </button>
          </div>
        </div>

        <div class="assoc-view">
          <div class="summary-grid">
            <div class="summary-item">
              <label>Total selling</label>
              <div class="value" id="sum-selling">$0.00</div>
              <small>Sum of all line item selling prices</small>
            </div>
            <div class="summary-item">
              <label>Total cost</label>
              <div class="value" id="sum-cost">$0.00</div>
              <small>What we pay (estimate)</small>
            </div>
            <div class="summary-item">
              <label>Total GP</label>
              <div class="value accent" id="sum-gp">$0.00</div>
              <small>Selling minus cost</small>
            </div>
            <div class="summary-item">
              <label>Overall GP %</label>
              <div class="value" id="sum-gp-percent">0.0%</div>
              <small>GP √∑ selling across the whole ticket</small>
            </div>
          </div>

          <div class="summary-grid" style="margin-top: 10px;">
            <div class="summary-item">
              <label>Total commission</label>
              <div class="value accent" id="sum-comm">$0.00</div>
              <small>Based on category (mattress / extend / accessory)</small>
            </div>
            <div class="summary-item">
              <label>Avg commission per $100 sold</label>
              <div class="value" id="sum-comm-per-100">$0.00</div>
              <small>Commission √∑ (selling √∑ 100)</small>
            </div>
            <div class="summary-item">
              <label>Mattress &amp; Extend selling</label>
              <div class="value" id="sum-mattress-extend">$0.00</div>
              <small>Core ticket value</small>
            </div>
            <div class="summary-item">
              <label>Accessories selling</label>
              <div class="value" id="sum-accessories">$0.00</div>
              <small>Protectors, pads, encasements, pillows, etc.</small>
            </div>
          </div>
        </div>

        <div class="customer-view-panel">
          <div class="customer-summary">
            <div class="customer-row">
              <span class="label">Ticket price</span>
              <span class="value" id="c-ticket">$0.00</span>
            </div>
            <div class="customer-row">
              <span class="label">Today‚Äôs package price</span>
              <span class="value accent" id="c-selling">$0.00</span>
            </div>
            <div class="customer-row">
              <span class="label">You save today</span>
              <span class="value" id="c-saving">$0.00</span>
            </div>
            <div class="customer-row">
              <span class="label">You save (%)</span>
              <span class="value" id="c-saving-percent">0.0%</span>
            </div>
          </div>

          <div class="customer-foot">
            <div class="customer-row">
              <span class="label">Approx save / month</span>
              <span class="value" id="c-save-month">$0.00</span>
            </div>
            <div class="customer-row">
              <span class="label">Approx save / pay</span>
              <span class="value" id="c-save-pay">$0.00</span>
            </div>
          </div>

          <div class="customer-breakdown">
            <div class="customer-breakdown-header">Package breakdown</div>
            <div class="customer-breakdown-list" id="customer-breakdown-list"></div>
          </div>

          <div class="coupon-block">
            <button type="button" class="btn btn-primary" id="btn-generate-coupon">Generate coupon</button>
            <div class="coupon-code" id="coupon-code" style="display:none;">
              <div class="code-label">Coupon code</div>
              <div class="code-box" id="coupon-code-value">GTA-0000</div>
            </div>
            <p class="policy-note" id="coupon-validity" style="display:none;"></p>
            <p class="policy-note">
              This package reflects most of the savings available today on this combination. Promotions, rebates and inventory can change over time.
            </p>
            <p class="policy-note">
              Sleep Country policies still apply. For full details on comfort periods, returns, exchanges and warranties, please refer to the official in-store and online policy. Opened pillows, bedding, protectors and toppers are generally final sale except under applicable warranties.
            </p>
          </div>
        </div>

        <div class="footer-note">
          <span><strong>Team GTA North ‚Äì One Region, One Standard.</strong></span>
        </div>
      </div>

      <div class="card protection-card">
        <div class="card-header">
          <h2>Protection packages</h2>
        </div>
        <div class="protection-grid">
          <div class="prot-column good">
            <div class="prot-label">GOOD</div>
            <div class="prot-title">Everyday Cool Shield</div>
            <div class="prot-subtitle">Essential system protection</div>
            <div class="prot-price">$199 / $249</div>
            <div class="prot-size-note">Queen / King example ticket</div>
            <ul class="prot-bullets">
              <li>Hush mattress protector</li>
              <li>Extend mattress protection</li>
            </ul>
          </div>
          <div class="prot-column better">
            <div class="prot-label">BETTER</div>
            <div class="prot-title">Comfort Plus Shield</div>
            <div class="prot-subtitle">Enhanced system protection</div>
            <div class="prot-price">$349 / $399</div>
            <div class="prot-size-note">Queen / King example ticket</div>
            <ul class="prot-bullets">
              <li>Cooling mattress protector (Hush)</li>
              <li>Premium pillow protectors</li>
              <li>Extend mattress protection</li>
              <li>Extend adjustable base protection</li>
            </ul>
          </div>
          <div class="prot-column best">
            <div class="prot-label">BEST</div>
            <div class="prot-title">Elite Arctic Shield</div>
            <div class="prot-subtitle">Ultimate cooling system protection</div>
            <div class="prot-price">$499 / $599</div>
            <div class="prot-size-note">Queen / King example ticket</div>
            <ul class="prot-bullets">
              <li>Graph-Iced or Purple cooling mattress protector</li>
              <li>Cooling pillow protectors</li>
              <li>Extend 10-year mattress protection</li>
              <li>Extend 10-year adjustable protection</li>
            </ul>
          </div>
        </div>
        <div class="prot-footnote">
          Package pricing is an example to help tell the story in front of the guest. Final ticket and savings come from the live quote above.
        </div>
      </div>

    </div>
  </div>

  <script>
    const COMM_RATES = {
      "mattress": 0.125,
      "extend": 0.125,
      "accessory": 0.18,
      "other": 0.0
    };

    const CATALOG = [
      { sku: "23BECMP-1", size: "T",   cost: 34.00, retail: 99.00,  category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-2", size: "F",   cost: 40.00, retail: 109.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-3", size: "Q",   cost: 43.00, retail: 119.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-4", size: "K",   cost: 50.00, retail: 129.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-6", size: "TXL", cost: 32.00, retail: 105.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-7", size: "FXL", cost: 43.00, retail: 119.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },

      { sku: "23BECPP-3", size: "Q", cost: 13.00, retail: 39.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECPP-4", size: "K", cost: 15.00, retail: 45.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },

      { sku: "23BETMP-1", size: "T",   cost: 37.00, retail: 119.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-2", size: "F",   cost: 43.00, retail: 139.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-3", size: "Q",   cost: 51.00, retail: 149.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-4", size: "K",   cost: 51.00, retail: 179.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-6", size: "TXL", cost: 40.00, retail: 139.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },

      { sku: "23BESMP-3SQ", size: "SHQ", cost: 35.00, retail: 149.00, category: "accessory", brand: "Bloom Split", source: "Bloom Essentials" },
      { sku: "23BESMP-4SK", size: "SHK", cost: 36.00, retail: 169.00, category: "accessory", brand: "Bloom Split", source: "Bloom Essentials" },

      { sku: "23BEME-1", size: "T",   cost: 48.00, retail: 149.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-2", size: "F",   cost: 56.00, retail: 189.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-3", size: "Q",   cost: 57.00, retail: 199.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-4", size: "K",   cost: 64.00, retail: 209.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-6", size: "TXL", cost: 54.00, retail: 159.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },

      { sku: "23BEBE-1", size: "T",   cost: 42.00, retail: 89.00,  category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },
      { sku: "23BEBE-2", size: "F",   cost: 51.00, retail: 99.00,  category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },
      { sku: "23BEBE-3", size: "Q",   cost: 55.00, retail: 109.00, category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },
      { sku: "23BEBE-6", size: "TXL", cost: 25.00, retail: 90.00,  category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },

      { sku: "24SGMP-3", size: "Q", cost: 74.00, retail: 169.00, category: "accessory", brand: "Simba Green", source: "Simba Green" },
      { sku: "24SGMP-4", size: "K", cost: 87.00, retail: 199.00, category: "accessory", brand: "Simba Green", source: "Simba Green" },

      { sku: "16CLIMAMP-1", size: "T",   cost: 44.00, retail: 139.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-2", size: "F",   cost: 58.00, retail: 149.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-3", size: "Q",   cost: 64.00, retail: 179.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-4", size: "K",   cost: 81.00, retail: 199.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-6", size: "TXL", cost: 50.00, retail: 179.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-7", size: "FXL", cost: 66.00, retail: 179.00, category: "accessory", brand: "Clima", source: "Clima" },

      { sku: "25HTSMP-1", size: "T",   cost: 62.00, retail: 169.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-2", size: "F",   cost: 72.00, retail: 189.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-3", size: "Q",   cost: 76.00, retail: 199.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-4", size: "K",   cost: 89.00, retail: 229.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-6", size: "TXL", cost: 71.00, retail: 189.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-3SH", size: "SHQ", cost: 82.00, retail: 219.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-4SH", size: "SHK", cost: 97.00, retail: 249.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },

      { sku: "25HTSPP-2", size: "S/Q", cost: 44.00, retail: 99.00,  category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSPP-4", size: "K",   cost: 47.00, retail: 119.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },

      { sku: "25HATMP-1", size: "T",   cost: 89.00, retail: 219.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-2", size: "F",   cost: 93.00, retail: 229.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-3", size: "Q",   cost: 98.00, retail: 249.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-4", size: "K",   cost: 113.00, retail: 289.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-6", size: "TXL", cost: 89.00, retail: 229.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-3SH", size: "SHQ", cost: 106.00, retail: 269.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-4SH", size: "SHK", cost: 119.00, retail: 309.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },

      { sku: "25HATPP-2", size: "S/Q", cost: 50.00, retail: 119.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATPP-4", size: "K",   cost: 52.00, retail: 129.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },

      { sku: "18PROTEX-1", size: "T",   cost: 82.00, retail: 219.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-2", size: "F",   cost: 86.00, retail: 229.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-3", size: "Q",   cost: 105.00, retail: 249.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-4", size: "K",   cost: 142.00, retail: 289.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-6", size: "TXL", cost: 81.00, retail: 219.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },

      { sku: "20PURMP-3", size: "Q",   cost: 95.00, retail: 269.00, category: "accessory", brand: "Purple", source: "Purple" },
      { sku: "20PURMP-4", size: "K",   cost: 103.00, retail: 299.00, category: "accessory", brand: "Purple", source: "Purple" },
      { sku: "20PURMP-6", size: "TXL", cost: 76.00, retail: 219.00, category: "accessory", brand: "Purple", source: "Purple" },

      { sku: "25HGIMP-1", size: "T",   cost: 91.00, retail: 249.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-2", size: "F",   cost: 102.00, retail: 279.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-3", size: "Q",   cost: 108.00, retail: 299.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-4", size: "K",   cost: 122.00, retail: 349.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-6", size: "TXL", cost: 120.00, retail: 299.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-3SH", size: "SHQ", cost: 121.00, retail: 329.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-4SH", size: "SHK", cost: 130.00, retail: 369.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },

      { sku: "25HGIPP-2", size: "S/Q", cost: 51.00, retail: 139.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIPP-4", size: "K",   cost: 54.00, retail: 149.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },

      { sku: "19PRTCMP-1", size: "T",   cost: 58.00, retail: 149.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-2", size: "F",   cost: 70.00, retail: 169.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-3", size: "Q",   cost: 74.00, retail: 179.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-4", size: "K",   cost: 98.00, retail: 209.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-6", size: "TXL", cost: 57.00, retail: 169.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-3S", size: "SHQ", cost: 76.00, retail: 199.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },

      { sku: "19PRTCTPP-3", size: "Q", cost: 37.00, retail: 100.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCTPP-4", size: "K", cost: 43.00, retail: 110.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },

      { sku: "19CMFMP-1", size: "T",   cost: 76.00, retail: 199.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-2", size: "F",   cost: 77.00, retail: 209.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-3", size: "Q",   cost: 82.00, retail: 229.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-4", size: "K",   cost: 109.00, retail: 269.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-6", size: "TXL", cost: 71.00, retail: 199.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-3SQ", size: "SHQ", cost: 98.00, retail: 229.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-4SK", size: "SHK", cost: 126.00, retail: 269.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },

      { sku: "19CMFPP-3", size: "Q", cost: 49.00, retail: 110.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFPP-4", size: "K", cost: 54.00, retail: 120.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },

      { sku: "19RFRSMP-1", size: "T",   cost: 116.00, retail: 229.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-2", size: "F",   cost: 131.00, retail: 259.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-3", size: "Q",   cost: 140.00, retail: 279.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-4", size: "K",   cost: 158.00, retail: 309.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-6", size: "TXL", cost: 117.00, retail: 229.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },

      { sku: "17ENCAS12-1", size: "T",   cost: 38.00, retail: 149.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-2", size: "F",   cost: 45.00, retail: 189.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-3", size: "Q",   cost: 48.00, retail: 199.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-4", size: "K",   cost: 57.00, retail: 209.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-6", size: "TXL", cost: 47.00, retail: 159.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },

      { sku: "17ENCAS09-1", size: "T",   cost: 22.00, retail: 89.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },
      { sku: "17ENCAS09-2", size: "F",   cost: 25.00, retail: 99.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },
      { sku: "17ENCAS09-3", size: "Q",   cost: 30.00, retail: 109.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },
      { sku: "17ENCAS09-6", size: "TXL", cost: 22.00, retail: 99.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },

      { sku: "19RENEWMP-3", size: "Q",   cost: 96.00, retail: 289.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },
      { sku: "19RENEWMP-4", size: "K",   cost: 113.00, retail: 309.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },
      { sku: "19RENEWMP-6", size: "TXL", cost: 80.00, retail: 229.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },

      { sku: "CLASSMP-1", size: "T",   cost: 32.00, retail: 99.00,  category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-2", size: "F",   cost: 40.00, retail: 109.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-3", size: "Q",   cost: 43.00, retail: 119.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-4", size: "K",   cost: 50.00, retail: 129.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-6", size: "TXL", cost: 32.00, retail: 105.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-7", size: "FXL", cost: 41.00, retail: 119.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },

      { sku: "CLASSPP-3", size: "Q", cost: 12.00, retail: 39.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSPP-4", size: "K", cost: 14.00, retail: 45.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },

      { sku: "20TERRYMP-1", size: "T",   cost: 34.00, retail: 119.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-2", size: "F",   cost: 41.00, retail: 139.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-3", size: "Q",   cost: 47.00, retail: 149.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-4", size: "K",   cost: 42.00, retail: 179.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-6", size: "TXL", cost: 38.00, retail: 139.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },

      { sku: "16NQMP-3SQ", size: "SHQ", cost: 31.00, retail: 149.00, category: "accessory", brand: "Non Quilted Split", source: "Protect-A-Bed" },
      { sku: "16NQMP-4SK", size: "SHK", cost: 32.00, retail: 169.00, category: "accessory", brand: "Non Quilted Split", source: "Protect-A-Bed" },

      { sku: "PABMP-1", size: "T",   cost: 48.00, retail: 120.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-2", size: "F",   cost: 63.00, retail: 140.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-3", size: "Q",   cost: 69.00, retail: 150.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-4", size: "K",   cost: 90.00, retail: 180.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-6", size: "TXL", cost: 52.00, retail: 140.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },

      { sku: "PABPP-2", size: "F", cost: 13.00, retail: 40.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABPP-3", size: "Q", cost: 15.00, retail: 46.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABPP-4", size: "K", cost: 16.00, retail: 50.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },

      { sku: "THERMP-1", size: "T",   cost: 72.00, retail: 160.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-2", size: "F",   cost: 78.00, retail: 180.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-3", size: "Q",   cost: 88.00, retail: 200.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-4", size: "K",   cost: 102.00, retail: 220.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-6", size: "TXL", cost: 75.00, retail: 160.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },

      { sku: "EXTENDMAT1",   size: "", cost: 8.99,  retail: 49.00,  category: "extend", brand: "Extend Mattress 1YR", source: "Extend" },
      { sku: "EXTENDMAT10",  size: "", cost: 19.03, retail: 99.00,  category: "extend", brand: "Extend Mattress 10YR", source: "Extend" },
      { sku: "EXTENDBASE10", size: "", cost: 39.50, retail: 149.00, category: "extend", brand: "Extend Base 10YR",   source: "Extend" },
      { sku: "EXTENDBASEFM", size: "", cost: 44.50, retail: 149.00, category: "extend", brand: "Extend Base FM",     source: "Extend" }
    ];

    // ---- Formatting helpers ----
    function formatMoney(n) {
      const num = Number(n);
      if (!isFinite(num)) return "$0.00";
      return "$" + num.toFixed(2);
    }

    function formatPercent(n) {
      const num = Number(n);
      if (!isFinite(num)) return "0.0%";
      return num.toFixed(1) + "%";
    }

    // ---- Catalog helpers ----
    function getProductBySku(sku) {
      return CATALOG.find(p => p.sku === sku) || null;
    }

    function buildCatalogOptions(filterText = "") {
      const filter = (filterText || "").toLowerCase().trim();
      const sorted = [...CATALOG].sort((a, b) => {
        if (a.source === b.source) return a.sku.localeCompare(b.sku);
        return a.source.localeCompare(b.source);
      });

      const frag = document.createDocumentFragment();

      const emptyOpt = document.createElement("option");
      emptyOpt.value = "";
      emptyOpt.textContent = "‚Äî Manual / custom item ‚Äî";
      frag.appendChild(emptyOpt);

      const sources = [...new Set(sorted.map(p => p.source))];
      sources.forEach(source => {
        const group = document.createElement("optgroup");
        group.label = source;

        sorted
          .filter(p => p.source === source)
          .filter(p => {
            if (!filter) return true;
            const haystack = (
              (p.sku || "") + " " +
              (p.brand || "") + " " +
              (p.source || "") + " " +
              (p.category || "")
            ).toLowerCase();
            return haystack.includes(filter);
          })
          .forEach(p => {
            const opt = document.createElement("option");
            opt.value = p.sku;
            const sizeText = p.size ? " ‚Äì " + p.size : "";
            opt.textContent = p.sku + sizeText + " ‚Äì $" + Number(p.retail).toFixed(2);
            group.appendChild(opt);
          });

        if (group.children.length > 0) {
          frag.appendChild(group);
        }
      });

      return frag;
    }

    function populateCatalogOptions(selectEl, filterText = "") {
      if (!selectEl) return;
      const current = selectEl.value;
      while (selectEl.firstChild) {
        selectEl.removeChild(selectEl.firstChild);
      }
      const frag = buildCatalogOptions(filterText);
      selectEl.appendChild(frag);
      if (current) {
        selectEl.value = current;
      }
    }

    function buildSizeSelect() {
      const sizes = ["", "T", "TXL", "F", "FXL", "Q", "K", "SK"];
      const sel = document.createElement("select");
      sel.className = "item-size";
      sizes.forEach(size => {
        const opt = document.createElement("option");
        opt.value = size;
        opt.textContent = size;
        sel.appendChild(opt);
      });
      return sel;
    }

    // ---- Row helpers ----
    function applyCatalogToRow(row, sku) {
      const prod = getProductBySku(sku);
      const sizeEl = row.querySelector(".item-size");
      const brandEl = row.querySelector(".item-brand");
      const nameEl = row.querySelector(".item-name");
      const catEl = row.querySelector(".item-category");
      const retailEl = row.querySelector(".item-retail");
      const sellEl = row.querySelector(".item-selling");
      const costEl = row.querySelector(".item-cost");
      const dealEl = row.querySelector(".item-deal");

      if (!prod) {
        if (sizeEl) sizeEl.value = "";
        brandEl.value = "";
        if (!nameEl.value) nameEl.value = "";
        retailEl.value = "";
        sellEl.value = "";
        costEl.value = "";
        dealEl.value = "";
        return;
      }

      if (sizeEl) sizeEl.value = prod.size || "";
      brandEl.value = prod.brand || "";
      if (!nameEl.value) nameEl.value = prod.sku;
      catEl.value = prod.category || "accessory";
      retailEl.value = Number(prod.retail).toFixed(2);
      costEl.value = Number(prod.cost).toFixed(2);

      // Default 15% discount
      dealEl.value = "15";
      applyDealToRow(row);
    }

    function applyDealToRow(row) {
      const retailEl = row.querySelector(".item-retail");
      const dealEl = row.querySelector(".item-deal");
      const sellEl = row.querySelector(".item-selling");

      const retail = parseFloat(retailEl.value || "0");
      const deal = parseFloat(dealEl.value || "0");

      if (!isNaN(retail) && !isNaN(deal)) {
        const selling = retail * (1 - deal / 100);
        sellEl.value = selling.toFixed(2);
      }
    }

    function onSizeChange(row) {
      const size = row.querySelector(".item-size")?.value || "";
      const catalogEl = row.querySelector(".item-catalog");
      const currentSku = catalogEl.value;
      if (!currentSku || !size) {
        recalcAll();
        return;
      }
      const baseSku = currentSku.split("-")[0];
      const match = CATALOG.find(p => p.sku.startsWith(baseSku + "-") && p.size === size);
      if (match) {
        catalogEl.value = match.sku;
        applyCatalogToRow(row, match.sku);
      }
      recalcAll();
    }

    function addRow(preset = {}) {
      const tbody = document.querySelector("#bundle-table tbody");
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>
          <input type="text" class="item-catalog-search" placeholder="Search SKU or brand" />
          <select class="item-catalog"></select>
        </td>
        <td class="size-cell"></td>
        <td>
          <input type="text" class="item-brand" readonly />
        </td>
        <td>
          <input type="text" class="item-name" placeholder="Note, description, etc." />
        </td>
        <td>
          <select class="item-category">
            <option value="mattress">Mattress</option>
            <option value="extend">Extend</option>
            <option value="accessory">Accessory</option>
            <option value="other">Other</option>
          </select>
        </td>
        <td>
          <input type="number" class="item-retail" min="0" step="0.01" readonly />
        </td>
        <td>
          <input type="number" class="item-deal" min="-90" max="90" step="1" value="15" />
        </td>
        <td>
          <input type="number" class="item-selling" min="0" step="0.01" />
        </td>
        <td>
          <input type="number" class="item-cost" min="0" step="0.01" />
        </td>
        <td>
          <input type="text" class="item-gp" readonly />
        </td>
        <td>
          <input type="text" class="item-gp-percent" readonly />
        </td>
        <td>
          <input type="text" class="item-comm-amt" readonly />
        </td>
        <td style="text-align:center;">
          <button type="button" class="btn btn-danger" style="padding:2px 8px; font-size:11px;" onclick="removeRow(this)">‚úï</button>
        </td>
      `;

      const sizeCell = row.querySelector(".size-cell");
      const sizeSelect = buildSizeSelect();
      sizeSelect.addEventListener("change", () => onSizeChange(row));
      sizeCell.appendChild(sizeSelect);

      const catalogSelect = row.querySelector(".item-catalog");
      const searchInput = row.querySelector(".item-catalog-search");
      populateCatalogOptions(catalogSelect);

      if (searchInput) {
        searchInput.addEventListener("input", () => {
          populateCatalogOptions(catalogSelect, searchInput.value || "");
        });
      }

      if (preset.sku) {
        catalogSelect.value = preset.sku;
        applyCatalogToRow(row, preset.sku);
      } else if (preset.name) {
        row.querySelector(".item-name").value = preset.name;
      }

      catalogSelect.addEventListener("change", () => {
        const sku = catalogSelect.value;
        applyCatalogToRow(row, sku);
        recalcAll();
      });

      const dealEl = row.querySelector(".item-deal");
      dealEl.addEventListener("input", () => {
        applyDealToRow(row);
        recalcAll();
      });

      row.querySelectorAll("input, select").forEach(el => {
        if (
          el.classList.contains("item-catalog") ||
          el.classList.contains("item-catalog-search") ||
          el.classList.contains("item-size") ||
          el.classList.contains("item-brand") ||
          el.classList.contains("item-retail") ||
          el.classList.contains("item-gp") ||
          el.classList.contains("item-gp-percent") ||
          el.classList.contains("item-comm-amt") ||
          el.classList.contains("item-deal")
        ) {
          return;
        }
        el.addEventListener("input", recalcAll);
        el.addEventListener("change", recalcAll);
      });

      tbody.appendChild(row);
      recalcAll();
    }

    function removeRow(btn) {
      const row = btn.closest("tr");
      if (!row) return;
      row.remove();
      recalcAll();
    }

    function clearAll() {
      const tbody = document.querySelector("#bundle-table tbody");
      if (!tbody) return;
      tbody.innerHTML = "";
      recalcAll();
    }

    function addPresetProtectBundle() {
      clearAll();
      addRow({ sku: "25HTSMP-3" });
      addRow({ sku: "25HTSPP-2" });
      addRow({ sku: "EXTENDMAT10" });
      addRow({ sku: "EXTENDBASE10" });
    }

    // ---- View & coupon ----
    function setViewMode(mode) {
      const body = document.body;
      const detailBtn = document.getElementById("btn-detail-view");
      const customerBtn = document.getElementById("btn-customer-view");

      body.classList.remove("packages-view");

      if (mode === "customer") {
        body.classList.add("customer-view");
        if (detailBtn) detailBtn.classList.remove("active");
        if (customerBtn) customerBtn.classList.add("active");
      } else {
        body.classList.remove("customer-view");
        if (detailBtn) detailBtn.classList.add("active");
        if (customerBtn) customerBtn.classList.remove("active");
      }
    }

    function toggleProtectionView() {
      const body = document.body;
      const btn = document.getElementById("btn-show-packages");
      const isOn = body.classList.contains("packages-view");

      if (isOn) {
        body.classList.remove("packages-view");
        if (btn) {
          btn.innerHTML = '<span class="icon">üõ°Ô∏è</span> Protection packages';
        }
      } else {
        body.classList.remove("customer-view");
        body.classList.add("packages-view");
        if (btn) {
          btn.innerHTML = '<span class="icon">‚¨ÖÔ∏è</span> Back to ticket';
        }
      }
    }

    function buildCouponCode() {
      const letters = "ABCDEFGHJKLMNPQRSTUVWXYZ";
      const digits = "23456789";
      let suffix = "";
      for (let i = 0; i < 2; i++) {
        suffix += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      suffix += "-";
      for (let i = 0; i < 4; i++) {
        suffix += digits.charAt(Math.floor(Math.random() * digits.length));
      }
      return "GTA-" + suffix;
    }

    function updateCouponValidity() {
      const validityEl = document.getElementById("coupon-validity");
      if (!validityEl) return;
      const now = new Date();
      const end = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
      const opts = { year: "numeric", month: "short", day: "numeric" };
      const startStr = now.toLocaleDateString(undefined, opts);
      const endStr = end.toLocaleDateString(undefined, opts);
      validityEl.textContent = "Coupon valid for 30 days from " + startStr + " to " + endStr + ", while package and inventory remain available.";
    }

    function generateCoupon() {
      const codeWrap = document.getElementById("coupon-code");
      const codeEl = document.getElementById("coupon-code-value");
      const validityEl = document.getElementById("coupon-validity");
      if (!codeWrap || !codeEl || !validityEl) return;
      codeEl.textContent = buildCouponCode();
      codeWrap.style.display = "inline-block";
      validityEl.style.display = "block";
      updateCouponValidity();
    }

    // ---- Totals ----
    function recalcAll() {
      const rows = document.querySelectorAll("#bundle-table tbody tr");

      let sumRetail = 0;
      let sumSelling = 0;
      let sumCost = 0;
      let sumGP = 0;
      let sumComm = 0;
      let sumMattressExtend = 0;
      let sumAccessories = 0;

      const breakdownRows = [];

      rows.forEach(row => {
        const category = (row.querySelector(".item-category")?.value || "mattress").toLowerCase();
        const retailVal = parseFloat(row.querySelector(".item-retail")?.value || "0");
        const sellVal = parseFloat(row.querySelector(".item-selling")?.value || "0");
        const costVal = parseFloat(row.querySelector(".item-cost")?.value || "0");

        if (!isNaN(retailVal)) sumRetail += retailVal;
        if (!isNaN(sellVal)) sumSelling += sellVal;
        if (!isNaN(costVal)) sumCost += costVal;

        const gp = sellVal - costVal;
        const gpPercent = sellVal > 0 ? (gp / sellVal) * 100 : 0;
        const rate = COMM_RATES[category] ?? 0;
        const commAmt = gp * rate;

        const gpEl = row.querySelector(".item-gp");
        const gpPctEl = row.querySelector(".item-gp-percent");
        const commEl = row.querySelector(".item-comm-amt");
        if (gpEl) gpEl.value = formatMoney(gp);
        if (gpPctEl) gpPctEl.value = formatPercent(gpPercent);
        if (commEl) commEl.value = formatMoney(commAmt);

        if (!isNaN(gp)) sumGP += gp;
        if (!isNaN(commAmt)) sumComm += commAmt;

        if (category === "mattress" || category === "extend") {
          if (!isNaN(sellVal)) sumMattressExtend += sellVal;
        } else if (category === "accessory") {
          if (!isNaN(sellVal)) sumAccessories += sellVal;
        }

        if (retailVal > 0 || sellVal > 0) {
          const brand = (row.querySelector(".item-brand")?.value || "").trim();
          const note = (row.querySelector(".item-name")?.value || "").trim();
          const sku = (row.querySelector(".item-catalog")?.value || "").trim();

          let label = "";
          if (brand && note) {
            label = brand + " ‚Äì " + note;
          } else if (brand) {
            label = brand;
          } else if (note) {
            label = note;
          } else if (sku) {
            label = sku;
          } else {
            label = "Item";
          }

          const save = retailVal - (sellVal || 0);
          breakdownRows.push({ label, retail: retailVal, selling: sellVal, save });
        }
      });

      const overallGPPercent = sumSelling > 0 ? (sumGP / sumSelling) * 100 : 0;
      const commPer100 = sumSelling > 0 ? sumComm / (sumSelling / 100) : 0;

      const sumSellEl = document.getElementById("sum-selling");
      const sumCostEl = document.getElementById("sum-cost");
      const sumGpEl = document.getElementById("sum-gp");
      const sumGpPctEl = document.getElementById("sum-gp-percent");
      const sumCommEl = document.getElementById("sum-comm");
      const sumCommPer100El = document.getElementById("sum-comm-per-100");
      const sumMattExtEl = document.getElementById("sum-mattress-extend");
      const sumAccEl = document.getElementById("sum-accessories");

      if (sumSellEl) sumSellEl.textContent = formatMoney(sumSelling);
      if (sumCostEl) sumCostEl.textContent = formatMoney(sumCost);
      if (sumGpEl) sumGpEl.textContent = formatMoney(sumGP);
      if (sumGpPctEl) sumGpPctEl.textContent = formatPercent(overallGPPercent);
      if (sumCommEl) sumCommEl.textContent = formatMoney(sumComm);
      if (sumCommPer100El) sumCommPer100El.textContent = formatMoney(commPer100);
      if (sumMattExtEl) sumMattExtEl.textContent = formatMoney(sumMattressExtend);
      if (sumAccEl) sumAccEl.textContent = formatMoney(sumAccessories);

      const cTicketEl = document.getElementById("c-ticket");
      const cSellingEl = document.getElementById("c-selling");
      const cSavingEl = document.getElementById("c-saving");
      const cSavingPctEl = document.getElementById("c-saving-percent");
      const cSaveMonthEl = document.getElementById("c-save-month");
      const cSavePayEl = document.getElementById("c-save-pay");

      const totalSaving = sumRetail - sumSelling;
      const savingPercent = sumRetail > 0 ? (totalSaving / sumRetail) * 100 : 0;

      if (cTicketEl) cTicketEl.textContent = formatMoney(sumRetail);
      if (cSellingEl) cSellingEl.textContent = formatMoney(sumSelling);
      if (cSavingEl) cSavingEl.textContent = formatMoney(totalSaving > 0 ? totalSaving : 0);
      if (cSavingPctEl) cSavingPctEl.textContent = formatPercent(savingPercent > 0 ? savingPercent : 0);

      const approxMonthly = totalSaving > 0 ? totalSaving / 12 : 0;
      const approxPerPay = totalSaving > 0 ? totalSaving / 26 : 0;
      if (cSaveMonthEl) cSaveMonthEl.textContent = formatMoney(approxMonthly);
      if (cSavePayEl) cSavePayEl.textContent = formatMoney(approxPerPay);

      const breakdownContainer = document.getElementById("customer-breakdown-list");
      if (breakdownContainer) {
        breakdownContainer.innerHTML = "";
        breakdownRows.forEach(item => {
          const ticket = formatMoney(item.retail);
          const price = formatMoney(item.selling || 0);
          const save = item.save > 0 ? formatMoney(item.save) : "$0.00";
          const div = document.createElement("div");
          div.className = "cb-row";
          div.innerHTML =
            '<div class="cb-main">' + item.label + '</div>' +
            '<div class="cb-sub">Ticket ' + ticket +
            " ‚Üí Your price " + price +
            " ¬∑ Save " + save + "</div>";
          breakdownContainer.appendChild(div);
        });
      }
    }

    // ---- Init ----
    window.addEventListener("DOMContentLoaded", () => {
      // Prefill with high-commission Hush + Extend combo
      addRow({ sku: "25HTSMP-3" });
      addRow({ sku: "EXTENDMAT10" });
      addRow({ sku: "EXTENDBASE10" });
      recalcAll();
      setViewMode("detail");

      const detailBtn = document.getElementById("btn-detail-view");
      const customerBtn = document.getElementById("btn-customer-view");
      const couponBtn = document.getElementById("btn-generate-coupon");

      if (detailBtn) detailBtn.addEventListener("click", () => setViewMode("detail"));
      if (customerBtn) customerBtn.addEventListener("click", () => setViewMode("customer"));
      if (couponBtn) couponBtn.addEventListener("click", generateCoupon);
    });
  </script>
</body>
</html>